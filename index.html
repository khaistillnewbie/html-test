<!-- iOS Home Screen icon -->
<link rel="apple-touch-icon" href="icon.png">
<!-- Favicon browser -->
<link rel="icon" href="icon.png" type="image/png">
<meta name="theme-color" content="#ffffff">

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spending Tracker PRO</title>
<style>
:root{
  --bg:#f6f7fb; --card:#fff; --primary:#4f46e5;
  --cash:#22c55e; --qr:#0ea5e9; --cc:#f59e0b;
  --text:#1f2937; --muted:#6b7280;
}
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg); margin:0; padding:16px;
}
.center{text-align:center;}
h2{margin:0;}
.subtitle{color:var(--muted); font-size:14px; margin-bottom:20px;}

.dashboard-container{
  display:flex; justify-content:space-between; gap:10px;
  flex-wrap:wrap; margin-bottom:20px;
}
.dashboard-card{
  flex:1; min-width:90px;
  background:var(--card); border-radius:12px;
  padding:16px; box-shadow:0 8px 16px rgba(0,0,0,0.05);
  text-align:center; cursor:pointer;
  transition: transform 0.1s;
}
.dashboard-card:hover{transform:scale(1.03);}
.dashboard-card h3{margin:0;font-size:14px;color:var(--muted);}
.dashboard-card p{margin:4px 0 0; font-size:18px; font-weight:600;}

.card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px; box-shadow:0 10px 20px rgba(0,0,0,0.06);}
label{display:block;font-size:13px;color:var(--muted);margin-top:10px;}
input,select,button{width:100%;padding:12px;margin-top:6px;border-radius:10px;border:1px solid #e5e7eb;font-size:15px;}
button{border:none;background:var(--primary);color:white;font-weight:600;margin-top:14px; cursor:pointer;}
table{width:100%;border-collapse:collapse;font-size:13px; display:block; overflow-x:auto;}
th,td{padding:10px;border-bottom:1px solid #e5e7eb; min-width:110px;}
th{background:#f3f4f6;}
footer{text-align:center;font-size:12px;color:var(--muted);margin-top:20px;}
</style>
</head>

<body>

<div class="center">
  <h2>Spending Tracker PRO</h2>
  <div class="subtitle">‚ÄúMoney is a tool. Awareness decides whether it controls you, or you control it.‚Äù</div>
</div>

<div class="dashboard-container">
  <div class="dashboard-card" id="dashCash" data-pay="Cash" style="border-top:4px solid var(--cash);">
    <h3>Cash</h3>
    <p>RM0.00</p>
  </div>
  <div class="dashboard-card" id="dashQR" data-pay="QR" style="border-top:4px solid var(--qr);">
    <h3>QR</h3>
    <p>RM0.00</p>
  </div>
  <div class="dashboard-card" id="dashCC" data-pay="Credit Card" style="border-top:4px solid var(--cc);">
    <h3>Credit Card</h3>
    <p>RM0.00</p>
  </div>
</div>

<div class="card">
  <label>Set Spending Limit (RM)</label>
  <input type="number" id="limitCash" placeholder="Cash" step="0.01">
  <input type="number" id="limitQR" placeholder="QR" step="0.01" style="margin-top:6px;">
  <input type="number" id="limitCC" placeholder="Credit Card" step="0.01" style="margin-top:6px;">
</div>

<div class="card">
  <label>Date & Time (GMT+8)</label>
  <input type="datetime-local" id="datetime">

  <label>Description</label>
  <input type="text" id="desc">

  <label>Category</label>
  <select id="category">
    <option>Makanan/Minuman</option>
    <option>Physical Shopping</option>
    <option>Online Shopping</option>
    <option>Minyak</option>
    <option>Topup Phone</option>
    <option>Lain-lain</option>
    <option>Capcut</option>
  </select>

  <label>Payment</label>
  <select id="payment">
    <option>Cash</option>
    <option>QR</option>
    <option>Credit Card</option>
  </select>

  <label>Amount (RM)</label>
  <input type="number" id="amount" step="0.01">

  <button onclick="addEntry()">+ Add Spending</button>
</div>

<div class="card">
  <button onclick="exportCSV()">üì§ Export CSV</button>
  <input type="file" id="importFile" accept=".csv" onchange="importCSV(event)">
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>Date</th><th>Description</th><th>Category</th><th>Payment</th><th>RM</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<footer>Made by Khai ‚ù§Ô∏è</footer>

<script>
let data = JSON.parse(localStorage.getItem("spendingData")) || [];
let currentFilter = null;

// GMT+8 helper
function gmt8Now(){
  const now = new Date();
  const utc = now.getTime() + (now.getTimezoneOffset()*60000);
  return new Date(utc + 8*60*60*1000);
}

// Set input default to GMT+8, editable
function liveClock(){ 
  const dtInput = document.getElementById("datetime");
  const current = gmt8Now();
  const iso = current.toISOString().slice(0,16);
  if(!dtInput.value) dtInput.value = iso; 
}
setInterval(liveClock,1000);
liveClock();

function render(){
  const tbody=document.getElementById("tableBody");
  tbody.innerHTML="";
  let sum={Cash:0,QR:0,"Credit Card":0};

  data.forEach(d=>{
    if(currentFilter && d.payment !== currentFilter) return;
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${d.datetime.replace("T"," ")}</td>
      <td>${d.desc}</td><td>${d.category}</td><td>${d.payment}</td>
      <td>${d.amount.toFixed(2)}</td>`;
    tbody.appendChild(tr);
    sum[d.payment]+=d.amount;
  });

  const dash = {
    Cash: document.getElementById("dashCash"),
    QR: document.getElementById("dashQR"),
    "Credit Card": document.getElementById("dashCC")
  };

  Object.keys(dash).forEach(key=>{
    dash[key].querySelector("p").innerText = `RM${sum[key].toFixed(2)}`;
    const limit = parseFloat(document.getElementById("limit"+key.replace(" ","")).value);
    if(limit>0 && sum[key] > limit){
      dash[key].style.borderTopColor = "red";
    } else {
      if(key==="Cash") dash[key].style.borderTopColor="var(--cash)";
      if(key==="QR") dash[key].style.borderTopColor="var(--qr)";
      if(key==="Credit Card") dash[key].style.borderTopColor="var(--cc)";
    }
  });

  localStorage.setItem("spendingData",JSON.stringify(data));
}

function addEntry(){
  if(!desc.value||!amount.value) return alert("Isi semua dulu");
  // Force GMT+8
  let dt = new Date(datetime.value);
  const offset = dt.getTimezoneOffset()*60000;
  dt = new Date(dt.getTime() - offset);
  const dtStr = dt.toISOString().slice(0,16);

  data.push({
    datetime: dtStr,
    desc:desc.value,
    category:category.value,
    payment:payment.value,
    amount:parseFloat(amount.value)
  });
  desc.value=""; amount.value="";
  render();
}

function exportCSV(){
  let csv="Date,Description,Category,Payment,Amount\n";
  data.forEach(d=>{
    csv+=`${d.datetime},${d.desc},${d.category},${d.payment},${d.amount}\n`;
  });
  const blob = new Blob([csv], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "spending.csv";
  a.click();
}

function importCSV(event){
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onload = function(e){
    const text = e.target.result.split("\n").slice(1);
    text.forEach(line=>{
      if(!line) return;
      const [datetime,desc,category,payment,amount] = line.split(",");
      data.push({datetime,desc,category,payment,amount:parseFloat(amount)});
    });
    render();
  };
  reader.readAsText(file);
}

document.querySelectorAll(".dashboard-card").forEach(card=>{
  card.addEventListener("click",()=>{
    const pay = card.dataset.pay;
    if(currentFilter === pay) currentFilter = null;
    else currentFilter = pay;
    render();
  });
});

render();
</script>
</body>
</html>

